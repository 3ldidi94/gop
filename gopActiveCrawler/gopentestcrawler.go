package gopactivecrawler

import (
    "fmt"
    "time"

    "github.com/hophouse/gop/utils"
)

func RunCrawlerCmd() {
    begin := time.Now()

    // bars
	progressBars := utils.InitWaitGroupBar()

    // Init the crawler
    c := InitCrawler()
    utils.CrawlerBar = progressBars.AddBar("Crawler", true)

    if *GoCrawlerOptions.ScreenshotPtr == true {
        utils.ScreenshotBar = progressBars.AddBar("Screenshot", false)
    }

    fmt.Printf("\n")
    fmt.Printf("[+] Crawling from URL: %s\n\n", Yellow(*GoCrawlerOptions.UrlPtr))

    // Start the crawler
    VisiteURL(&URLVisited, c, *GoCrawlerOptions.UrlPtr)

    progressBars.Wait()

    // If report option
    if *GoCrawlerOptions.ReportPtr == true {
        WriteRessourceListReport(append(External_ressources, Internal_ressources...))
    }

    // Stop time
    end := time.Now()

    // Print Statistics
    PrintRessourcesResume("Internal", *GoCrawlerOptions.UrlPtr, &Internal_ressources)
    PrintRessourcesResume("External", *GoCrawlerOptions.UrlPtr, &External_ressources)

    PrintStatistics(end.Sub(begin), &Internal_ressources, &External_ressources)
}